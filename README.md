# ä¸­åäººæ°‘å…±å’Œå›½è¡Œæ”¿åŒºåˆ’æ•°æ®
[![license](https://img.shields.io/github/license/snakejordan/administrative-divisions-of-China-on-Python.svg)](https://github.com/snakejordan/administrative-divisions-of-China-on-Python/blob/master/LICENSE)
[![author](https://img.shields.io/badge/Author-Snake-blue.svg)](https://ty289.com/)
## ç¯å¢ƒè¦æ±‚
* macOS or Linux or Windows
* python (3.6+)
* pip
* sqlite3
## ä¾èµ–åŒ…
[![requests_html](https://img.shields.io/pypi/v/requests_html.svg?label=requests_html)](https://pypi.org/project/requests_html/)
[![pyquery](https://img.shields.io/pypi/v/pyquery.svg?label=pyquery)](https://pypi.org/project/pyquery/)
[![sshtunnel](https://img.shields.io/pypi/v/sshtunnel.svg?label=sshtunnel)](https://pypi.org/project/sshtunnel/)
[![redis](https://img.shields.io/pypi/v/redis.svg?label=redis)](https://pypi.org/project/redis/)
## æ•°æ®æ¥æº
#### æ•°æ®æ¥æºè¯´æ˜ï¼š
ä¸­åäººæ°‘å…±å’Œå›½è¡Œæ”¿åŒºåˆ’å®˜æ–¹æ•°æ®åˆ†ä¸ºä¸¤ä¸ªæ¸ é“ï¼ˆæœ¬äººå·²çŸ¥æ¸ é“ï¼Œå¦‚æœ‰å…¶å®ƒå®˜æ–¹æ¸ é“å¯é€šè¿‡ [issues](https://github.com/snakejordan/administrative-divisions-of-China-on-Python/issues) è¿›è¡Œäº¤æµï¼‰ï¼Œåˆ†åˆ«ä¸º[æ°‘æ”¿éƒ¨](http://www.mca.gov.cn/article/sj/xzqh/)å’Œ[ç»Ÿè®¡å±€](http://www.stats.gov.cn/tjsj/tjbz/tjyqhdmhcxhfdm/)ï¼Œæœ¬é¡¹ç›®é‡‡ç”¨ç»Ÿè®¡å±€æ•°æ®ã€‚
#### æ•°æ®æ¥æºåŒºåˆ«ï¼š
* æ°‘æ”¿éƒ¨ï¼š
    * æ•°æ®å†å²ä¹…è¿œï¼ŒåŒ…æ‹¬ä» 1980 å¹´è‡³ä»Šè¡Œæ”¿åŒºåˆ’æ•°æ®ï¼›
    * æ•°æ®å±‚çº§è¾ƒå°‘ï¼Œæœ€å¤šåˆ†ä¸ºçœã€å¸‚ã€åŒºä¸‰çº§æ•°æ®ã€‚

* ç»Ÿè®¡å±€ï¼š
    * æ•°æ®å†å²è¾ƒæ–°ï¼ŒåŒ…æ‹¬ä» 2009 å¹´è‡³ä»Šè¡Œæ”¿åŒºåˆ’æ•°æ®ï¼›
    * æ•°æ®å±‚çº§è¾ƒå¤šï¼Œæœ€å¤šåˆ†ä¸ºçœçº§ã€åœ°çº§ã€å¿çº§ã€ä¹¡çº§ã€æ‘çº§äº”çº§æ•°æ®ã€‚
#### æœ¬é¡¹ç›®æ•°æ®æºï¼š
ä¸ºäº†æ•°æ®æ›´è¯¦ç»†ï¼Œæ‰€ä»¥é‡‡ç”¨[ç»Ÿè®¡å±€](http://www.stats.gov.cn/tjsj/tjbz/tjyqhdmhcxhfdm/)æ•°æ®ï¼Œå…·ä½“æ•°æ®æºé“¾æ¥å¦‚ä¸‹ï¼š
* [2018 å¹´](http://www.stats.gov.cn/tjsj/tjbz/tjyqhdmhcxhfdm/2018/)
* [2017 å¹´](http://www.stats.gov.cn/tjsj/tjbz/tjyqhdmhcxhfdm/2017/)
* [2016 å¹´](http://www.stats.gov.cn/tjsj/tjbz/tjyqhdmhcxhfdm/2016/)
* [2015 å¹´](http://www.stats.gov.cn/tjsj/tjbz/tjyqhdmhcxhfdm/2015/)
* [2014 å¹´](http://www.stats.gov.cn/tjsj/tjbz/tjyqhdmhcxhfdm/2014/)
* [2013 å¹´](http://www.stats.gov.cn/tjsj/tjbz/tjyqhdmhcxhfdm/2013/)
* [2012 å¹´](http://www.stats.gov.cn/tjsj/tjbz/tjyqhdmhcxhfdm/2012/)
* [2011 å¹´](http://www.stats.gov.cn/tjsj/tjbz/tjyqhdmhcxhfdm/2011/)
* [2010 å¹´](http://www.stats.gov.cn/tjsj/tjbz/tjyqhdmhcxhfdm/2010/)
* [2009 å¹´](http://www.stats.gov.cn/tjsj/tjbz/tjyqhdmhcxhfdm/2009/)
#### ç»Ÿè®¡ç”¨åŒºåˆ’ä»£ç å’ŒåŸä¹¡åˆ’åˆ†ä»£ç ç¼–åˆ¶è§„åˆ™ï¼š
å‚è€ƒï¼š[ç»Ÿè®¡ç”¨åŒºåˆ’ä»£ç å’ŒåŸä¹¡åˆ’åˆ†ä»£ç ç¼–åˆ¶è§„åˆ™](http://www.stats.gov.cn/tjsj/tjbz/200911/t20091125_8667.html)
## é…ç½®æ–‡ä»¶
```python
# ä¸º True ä¼šè¯¦ç»†æ˜¾ç¤ºæ“ä½œä¸­çš„æ¯å¥æ—¥å¿—å†…å®¹ã€‚
SHOW_LOG = True

# çˆ¬è™«æ¯æ¬¡çˆ¬å–åçš„ä¼‘çœ æ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼Œæ­£å¸¸æƒ…å†µä¸‹æ— éœ€ä¼‘çœ ã€‚
CRAWLER_SLEEP_TIME = 0

# csv è¾“å‡ºæ–‡ä»¶çš„å­—ç¬¦ç¼–ç ï¼Œé»˜è®¤ä¸º UTF-8ï¼Œä¸ºäº† Microsoft Office Excel å¯ä»¥æ­£å¸¸æ˜¾ç¤ºå¯ä»¥è®¾ç½®ä¸º GBKï¼Œä½†æ˜¯ GBK å¯èƒ½ä¼šå‡ºç°å­—ç¬¦ç¼–ç å¼‚å¸¸å¯¼è‡´ç¨‹åºè¿è¡Œå¤±è´¥ã€‚
CSV_OUTPUT_FILE_ENCODING = 'UTF-8'

# Redis åœ°å€
REDIS_HOST = '127.0.0.1'
# Redis ç«¯å£
REDIS_PORT = 6379
# Redis å¯†ç 
REDIS_PASS = ''
# Redis åº“å·
REDIS_DB = 3

# Redis æœåŠ¡å™¨åœ¨æœ¬åœ°ä¸å¯è®¿é—®çš„è¿œç¨‹æœåŠ¡å™¨æ—¶ï¼Œå¯é€šè¿‡é…ç½® ssh éš§é“çš„æ–¹å¼è®¿é—® Redisï¼Œä»è€Œä¿å­˜æ•°æ®åˆ°è¿œç¨‹ Redis æœåŠ¡å™¨ã€‚
# SSH éš§é“åœ°å€
SSH_HOST = ''
# SSH éš§é“ç«¯å£
SSH_PORT = 22
# SSH éš§é“ç”¨æˆ·å
SSH_USERNAME = ''
# SSH éš§é“å¯†ç 
SSH_PASSWORD = ''
# SSH éš§é“è¯ä¹¦æ–‡ä»¶ï¼ˆå®Œæ•´ç‰©ç†è·¯å¾„ï¼‰
SSH_PKEY = ''
# SSH éš§é“ç»‘å®šåœ°å€
SSH_BIND_HOST = '127.0.0.1'
# SSH éš§é“ç»‘å®šç«¯å£
SSH_BIND_PORT = 6379
```
## æ•°æ®æ ¼å¼
```sqlite
-- çœçº§
CREATE TABLE `province` (`statistical_code` CHAR(12) PRIMARY KEY, `code` CHAR(2), `name` VARCHAR(100))
```
```sqlite
-- åœ°çº§
CREATE TABLE `city` (`statistical_code` CHAR(12) PRIMARY KEY, `code` CHAR(4), `name` VARCHAR(100), `province_statistical_code` CHAR(12))
```
```sqlite
-- å¿çº§
CREATE TABLE `county` (`statistical_code` CHAR(12) PRIMARY KEY, `code` CHAR(6), `name` VARCHAR(100), `province_statistical_code` CHAR(12), `city_statistical_code` CHAR(12))
```
```sqlite
-- ä¹¡çº§
CREATE TABLE `town` (`statistical_code` CHAR(12) PRIMARY KEY, `code` CHAR(9), `name` VARCHAR(100), `province_statistical_code` CHAR(12), `city_statistical_code` CHAR(12), `county_statistical_code` CHAR(12))
```
```sqlite
-- æ‘çº§
CREATE TABLE `village` (`statistical_code` CHAR(12) PRIMARY KEY, `code` CHAR(12), `name` VARCHAR(100), `province_statistical_code` CHAR(12), `city_statistical_code` CHAR(12), `county_statistical_code` CHAR(12), `town_statistical_code` CHAR(12))
```
![æ•°æ®æ ¼å¼](https://raw.githubusercontent.com/snakejordan/static-file/master/administrative-divisions-of-China-on-Python/doc/images/sqlite_data_structure.png "æ•°æ®æ ¼å¼")
## ä½¿ç”¨è¯´æ˜
å®Œæˆç¯å¢ƒé…ç½®åŠä¾èµ–å®‰è£…åï¼Œå¯é€šè¿‡è¿è¡Œ main.py æ–‡ä»¶çš„æ–¹å¼è¿è¡Œæœ¬é¡¹ç›®ï¼Œæœ¬é¡¹ç›®è¿è¡Œåé‡‡ç”¨äº¤äº’å¼å‘½ä»¤è¡Œè¿›è¡Œäº¤äº’æç¤ºã€‚
#### è¿è¡Œå‘½ä»¤ï¼š
```cmd
$ python3 main.py
```
#### åŠŸèƒ½åˆ—è¡¨ï¼š
* æŠ“å–ç»Ÿè®¡å±€ä¿¡æ¯å¹¶ä¿å­˜å…¥åº“ã€‚ï¼ˆè¾“å…¥1ï¼‰
* å¯¼å‡ºç»Ÿè®¡å±€ä¿¡æ¯ä¸­æ‰€æœ‰çœã€åœ°ã€å¿ã€ä¹¡ã€æ‘æ•°æ®çš„ csv ç‰ˆæœ¬ã€‚ï¼ˆè¾“å…¥2ï¼‰
* å¯¼å‡ºç»Ÿè®¡å±€ä¿¡æ¯ä¸­æ‰€æœ‰çœã€åœ°ã€å¿ã€ä¹¡ã€æ‘æ•°æ®çš„ json ç‰ˆæœ¬ã€‚ï¼ˆè¾“å…¥3ï¼‰
* å¯¼å‡ºç»Ÿè®¡å±€ä¿¡æ¯ä¸­æ‰€æœ‰çœã€åœ°ã€å¿ã€ä¹¡ã€æ‘æ•°æ®åˆ° Redisã€‚ï¼ˆè¾“å…¥4ï¼‰
#### è¿è¡Œç¤ºä¾‹ï¼š
![è¿è¡Œç¤ºä¾‹](https://raw.githubusercontent.com/snakejordan/static-file/master/administrative-divisions-of-China-on-Python/doc/images/running_example.gif "è¿è¡Œç¤ºä¾‹")
## åœ¨çº¿æ¥å£
#### äº”çº§åœ¨çº¿æ¥å£åœ°å€ï¼š
* çœçº§ï¼šhttps://pcctv.public.ty289.com/stats/province
* åœ°çº§ï¼šhttps://pcctv.public.ty289.com/stats/city
* å¿çº§ï¼šhttps://pcctv.public.ty289.com/stats/county
* ä¹¡çº§ï¼šhttps://pcctv.public.ty289.com/stats/town
* æ‘çº§ï¼šhttps://pcctv.public.ty289.com/stats/village
#### è¯·æ±‚å‚æ•°ï¼š
é™¤çœçº§æ— éœ€è¯·æ±‚å‚æ•°ä»¥å¤–ï¼Œå…¶å®ƒå››çº§å‡éœ€è¦åç§°ä¸º topCode çš„ä¸Šçº§ç¼–å·ä½œä¸ºè¯·æ±‚å‚æ•°ï¼ŒtopCode çš„å€¼ä¸ºä¸Šä¸€çº§æ•°æ®çš„ statistical_code å€¼ã€‚
#### è¯·æ±‚æ–¹æ³•ï¼š
æ”¯æŒ GET POST PUT ç­‰è¯·æ±‚æ–¹æ³•ï¼Œæ”¯æŒ XHR fetch ç­‰è¯·æ±‚æ–¹å¼ã€‚
#### Postman ç¤ºä¾‹ï¼š
çœçº§ç¤ºä¾‹ï¼š

![çœçº§ç¤ºä¾‹](https://raw.githubusercontent.com/snakejordan/static-file/master/administrative-divisions-of-China-on-Python/doc/images/api_example_province.png "çœçº§ç¤ºä¾‹")

åœ°çº§ç¤ºä¾‹ï¼š

![åœ°çº§ç¤ºä¾‹](https://raw.githubusercontent.com/snakejordan/static-file/master/administrative-divisions-of-China-on-Python/doc/images/api_example_city.png "åœ°çº§ç¤ºä¾‹")

å¿çº§ç¤ºä¾‹ï¼š

![å¿çº§ç¤ºä¾‹](https://raw.githubusercontent.com/snakejordan/static-file/master/administrative-divisions-of-China-on-Python/doc/images/api_example_county.png "å¿çº§ç¤ºä¾‹")

ä¹¡çº§ç¤ºä¾‹ï¼š

![ä¹¡çº§ç¤ºä¾‹](https://raw.githubusercontent.com/snakejordan/static-file/master/administrative-divisions-of-China-on-Python/doc/images/api_example_town.png "ä¹¡çº§ç¤ºä¾‹")

æ‘çº§ç¤ºä¾‹ï¼š

![æ‘çº§ç¤ºä¾‹](https://raw.githubusercontent.com/snakejordan/static-file/master/administrative-divisions-of-China-on-Python/doc/images/api_example_village.png "æ‘çº§ç¤ºä¾‹")
#### ç‰¹ä¾‹ï¼š
éƒ¨åˆ†åœ°åŒºä¸å­˜åœ¨äº”çº§æ•°æ®ï¼Œä¸ºä¿è¯ä¸€è‡´æ€§æ¥å£ç»Ÿä¸€è¿”å›äº”çº§æ•°æ®ï¼Œæœ¬çº§æ•°æ®ä¸ä¸Šçº§æ•°æ®çš„ statistical_code ç›¸åŒæ—¶æ„å‘³ç€å±‚çº§ä¸è¶³äº”çº§ï¼Œéœ€è°ƒç”¨è€…è¿›è¡Œé¢å¤–å¤„ç†ã€‚

ä¾‹å¦‚ï¼š

å¹¿ä¸œçœï¼ˆ440000000000ï¼‰ -> ä¸œèå¸‚ï¼ˆ441900000000ï¼‰ -> ä¸œåŸè¡—é“åŠäº‹å¤„ï¼ˆ441900003000ï¼‰ -> å²—è´ç¤¾åŒºå±…æ°‘å§”å‘˜ä¼šï¼ˆ441900003001ï¼‰

æ¥å£è°ƒç”¨åŠè¿”å›å‚è€ƒä¸‹å›¾ï¼š

ä¸œèå¸‚çœçº§ç¤ºä¾‹ï¼š

![ä¸œèå¸‚çœçº§ç¤ºä¾‹](https://raw.githubusercontent.com/snakejordan/static-file/master/administrative-divisions-of-China-on-Python/doc/images/api_example_province_dongguan.png "ä¸œèå¸‚çœçº§ç¤ºä¾‹")

ä¸œèå¸‚åœ°çº§ç¤ºä¾‹ï¼š

![ä¸œèå¸‚åœ°çº§ç¤ºä¾‹](https://raw.githubusercontent.com/snakejordan/static-file/master/administrative-divisions-of-China-on-Python/doc/images/api_example_city_dongguan.png "ä¸œèå¸‚åœ°çº§ç¤ºä¾‹")

ä¸œèå¸‚å¿çº§ç¤ºä¾‹ï¼š

![ä¸œèå¸‚å¿çº§ç¤ºä¾‹](https://raw.githubusercontent.com/snakejordan/static-file/master/administrative-divisions-of-China-on-Python/doc/images/api_example_county_dongguan.png "ä¸œèå¸‚å¿çº§ç¤ºä¾‹")

ä¸œèå¸‚ä¹¡çº§ç¤ºä¾‹ï¼š

![ä¸œèå¸‚ä¹¡çº§ç¤ºä¾‹](https://raw.githubusercontent.com/snakejordan/static-file/master/administrative-divisions-of-China-on-Python/doc/images/api_example_town_dongguan.png "ä¸œèå¸‚ä¹¡çº§ç¤ºä¾‹")

ä¸œèå¸‚æ‘çº§ç¤ºä¾‹ï¼š

![ä¸œèå¸‚æ‘çº§ç¤ºä¾‹](https://raw.githubusercontent.com/snakejordan/static-file/master/administrative-divisions-of-China-on-Python/doc/images/api_example_village_dongguan.png "ä¸œèå¸‚æ‘çº§ç¤ºä¾‹")
## ä¸‹è½½æ•°æ®
å·²å®Œæˆä»¥ä¸‹å¹´ä»½ï¼ˆ2009ã€2010ã€2011ã€2012ã€2013ã€2014ã€2015ã€2016ã€2017ã€2018ï¼‰çš„ sqlite3 æ ¼å¼æ•°æ®é‡‡é›†ï¼Œéœ€è¦ sqlite3 æ ¼å¼æ•°æ®å¯é€šè¿‡é‚®ä»¶ [snakejordan@gmail.com](mailto:snakejordan@gmail.com) ç´¢å–ã€‚
> æç¤ºï¼šé‚®ä»¶å›å¤çš„ä¸‹è½½é“¾æ¥ä¸º google drive ä¸­å­˜å‚¨çš„æ–‡ä»¶ï¼Œæ˜¯å¦èƒ½ä¸‹è½½ä½ æ‡‚å¾—ğŸ™ƒã€‚
## Over
æ©ï¼Œä»¥ä¸Šæ˜¯æ‰€æœ‰è¯´æ˜ï¼Œåé¢æ²¡æœ‰è¦è¯´çš„äº†ğŸ˜Šã€‚

-----

## ç‰¹åˆ«é¸£è°¢
æœ¬é¡¹ç›®æ˜¯å— [modood](https://github.com/modood) çš„ [Administrative-divisions-of-China](https://github.com/modood/Administrative-divisions-of-China) é¡¹ç›®å¯å‘è€Œç¼–å†™ï¼Œç”±äºä¸æ“…é•¿ NodeJS ä»¥åŠè§‰å¾— [Administrative-divisions-of-China](https://github.com/modood/Administrative-divisions-of-China) åœ¨æ•°æ®åŠä½¿ç”¨ä¾¿åˆ©æ€§ä¸Šæœ‰ä¸€ç‚¹ç‚¹é—®é¢˜ï¼Œæ‰€ä»¥é‡å¤é€ äº†ä¸ªè½®å­ï¼Œåœ¨æ­¤å¯¹ [modood](https://github.com/modood) è¡¨ç¤ºç‰¹åˆ«é¸£è°¢ã€‚